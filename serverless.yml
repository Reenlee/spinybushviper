service: spinybushviper

custom:
  webpack:
    webpackConfig: 'webpack.config.js'
    includeModules: true
    packager: 'yarn'

  settings:
    MDB_USERNAME: ${ssm:reenlee-mongodb-username}
    MDB_PASSWORD: ${ssm:reenlee-mongodb-password}
    MDB_DATABASE: ${ssm:reenlee-mongodb-database}-${self:provider.stage}

provider:
  name: aws
  stage: dev
  runtime: nodejs12.x
  websocketsApiRouteSelectionExpression: '$request.body.route'
  region: us-east-1
  profile: reenlee-admin
  environment: ${self:custom.settings}

plugins:
  - serverless-offline
  - serverless-webpack

functions:
  create_user1:
    handler: src/create_user.handler
    events:
      - http:
          method: get
          path: /create_user
          cors: true

  authenticate_user1:
    handler: src/authenticate_user.handler
    events:
      - http:
          method: get
          path: /authenticate_user
          cors: true

  default1:
    handler: src/websocket/default.handler
    events:
      - websocket: $default

  connect1:
    handler: src/websocket/connect.handler
    events:
      - websocket: $connect

  disconnect1:
    handler: src/websocket/disconnect.handler
    events:
      - websocket: $disconnect
